<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Jquery/P5.js -->
	<script src="https://cdn.jsdelivr.net/npm/p5@1/lib/p5.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/p5@1/lib/addons/p5.sound.min.js"></script>
			
	<script src="https://p5play.org/v3/planck.min.js"></script>
	<script src="https://p5play.org/v3/p5play.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.0.js"></script>

	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<title></title>

	<style type="text/css">
		html{
			overflow: hidden;
		}

	</style>

</head>
<body>

</body>

<script type="text/javascript">

    let jogador
	let fase = 11
	let fases
	let velocidadeJogador
	let tamanhoParede
	let zoom
	let respawn
	$.getJSON('fases.json', function(data) {fases =  data});

	
	function fade(jogador, fakewall){
		fakewall.color = "rgba(180, 180, 180, 0.6)"
	}

	function virar(enemy, walls){
		enemy.velocity.x = enemy.velocity.x * -1
		enemy.velocity.y = enemy.velocity.y * -1
	}

	function check(jogador, point){
		respawn = [point.x, point.y]
	}

	function setup() {
		createCanvas($(document).width(), $(document).height());
		world.gravity.y = 0;

		velocidadeJogador = fases["Fase" + fase]["velocidade"]
		zoom = fases["Fase" + fase]["zoom"]
		tamanhoParede = fases["Fase" + fase]["tamanhoParede"]

		jogador = new Group();
		jogador.w = 15;
		jogador.h = 15;
		jogador.bounciness = 0
		jogador.collider = "dynamic"
		jogador.stroke = "black"
		jogador.color = "#00a335"

		fakewalls = new Group();
		fakewalls.w = tamanhoParede;
		fakewalls.h = tamanhoParede;
		fakewalls.color = "rgba(92, 92, 92, 1)"
		fakewalls.stroke = "rgba(92, 92, 92, 1)"
		fakewalls.collider = 'none';

		walls = new Group();
		walls.w = tamanhoParede;
		walls.h = tamanhoParede;
		walls.color = "rgba(90, 90, 90, 1)"
		walls.bounciness = 0
		walls.collider = 'static';
		walls.stroke = "rgba(90, 90, 90, 1)"

		checkpoint = new Group();
		checkpoint.w = tamanhoParede;
		checkpoint.h = tamanhoParede;
		checkpoint.color = "rgba(0,127,255, 0.5)"
		checkpoint.bounciness = 0
		checkpoint.collider = 'none';
		checkpoint.stroke = "rgba(0,127,255, 0.5)"

		portal = new Group();
		portal.collider = 'static';
		portal.radius = tamanhoParede/100*20

		verticalEnemy = new Group()
		verticalEnemy.w = 15;
		verticalEnemy.h = 15;
		verticalEnemy.bounciness = 0
		verticalEnemy.color = "red"
		verticalEnemy.collider = "none"
		verticalEnemy.stroke = "black"

		horizontalEnemy = new Group()
		horizontalEnemy.w = 15;
		horizontalEnemy.h = 15;
		horizontalEnemy.bounciness = 0
		horizontalEnemy.color = "red"
		horizontalEnemy.collider = "none"
		horizontalEnemy.stroke = "black"

		diagonalEnemy = new Group()
		diagonalEnemy.w = 15;
		diagonalEnemy.h = 15;
		diagonalEnemy.bounciness = 0
		diagonalEnemy.color = "red"
		diagonalEnemy.collider = "none"
		diagonalEnemy.stroke = "black"

		jogador.tile = "P";
		walls.tile = "=";
		fakewalls.tile = "ยง";
		checkpoint.tile = "C";
		portal.tile = "*";
		verticalEnemy.tile = "|";
		horizontalEnemy.tile = "-";
		diagonalEnemy.tile = "/";

		faseAtual = new Tiles(
			fases["Fase" + fase]["tiles"],
			-tamanhoParede,
			-tamanhoParede,
			tamanhoParede,
			tamanhoParede
		);
		respawn = [jogador[0].x, jogador[0].y]

		for (let i in fases["Fase" + fase]["inimigosV"]){
			verticalEnemy[i].velocity.y = fases["Fase" + fase]["inimigosV"][i];
		}

		for (let i in fases["Fase" + fase]["inimigosH"]){
			horizontalEnemy[i].velocity.x = fases["Fase" + fase]["inimigosH"][i];
		}

		for (let i in fases["Fase" + fase]["inimigosD"]){
			diagonalEnemy[i].velocity.y = fases["Fase" + fase]["inimigosD"][i];
			diagonalEnemy[i].velocity.x = fases["Fase" + fase]["inimigosD"][i];
		}
		
	}

	function draw() {
		clear()
		background(200);
		jogador[0].rotateTo(0, 100)
		camera.zoom = zoom;
		camera.x = jogador[0].x;
		camera.y = jogador[0].y;
		
		verticalEnemy.overlaps(walls, virar)
		verticalEnemy.overlaps(fakewalls, virar)
		verticalEnemy.overlaps(portal, virar)

		horizontalEnemy.overlaps(walls, virar)
		horizontalEnemy.overlaps(fakewalls, virar)
		horizontalEnemy.overlaps(portal, virar)

		diagonalEnemy.overlaps(walls, virar)
		diagonalEnemy.overlaps(fakewalls, virar)
		diagonalEnemy.overlaps(portal, virar)

		jogador.overlaps(checkpoint, check)

		if (jogador.colliding(portal)){
			fase += 1
			faseAtual.remove()
			velocidadeJogador = fases["Fase" + fase]["velocidade"]
			zoom = fases["Fase" + fase]["zoom"]
			tamanhoParede = fases["Fase" + fase]["tamanhoParede"]
			walls.h = tamanhoParede
			walls.w = tamanhoParede
			fakewalls.h = tamanhoParede
			fakewalls.w = tamanhoParede
			portal.radius = tamanhoParede/100*20
			faseAtual = new Tiles(
				fases["Fase" + fase]["tiles"],
				-tamanhoParede,
				-tamanhoParede,
				tamanhoParede,
				tamanhoParede
			)
			respawn = [jogador[0].x, jogador[0].y]
			for (let i in fases["Fase" + fase]["inimigosV"]){
				verticalEnemy[i].velocity.y = fases["Fase" + fase]["inimigosV"][i];
			}
			for (let i in fases["Fase" + fase]["inimigosH"]){
				horizontalEnemy[i].velocity.x = fases["Fase" + fase]["inimigosH"][i];
			}
			for (let i in fases["Fase" + fase]["inimigosD"]){
				diagonalEnemy[i].velocity.y = fases["Fase" + fase]["inimigosD"][i];
				diagonalEnemy[i].velocity.x = fases["Fase" + fase]["inimigosD"][i];
			}
			jogador.x = respawn[0]
			jogador.y = respawn[1]
		}

		if (jogador.colliding(walls) || jogador.overlapping(verticalEnemy) || jogador.overlapping(horizontalEnemy) || jogador.overlapping(diagonalEnemy)){
			jogador.x = respawn[0]
			jogador.y = respawn[1]
		}

		jogador.overlapping(fakewalls, fade)

		x = 0;
		y = 0;
        if (kb.pressing('a') || kb.pressing('left')){
			x -= velocidadeJogador;
		}
		if (kb.pressing('d') || kb.pressing('right')){
			x += velocidadeJogador;
		}
		if (kb.pressing('w') || kb.pressing('up')){
			y -= velocidadeJogador;
		}
		if (kb.pressing('s') || kb.pressing('down')){
			y += velocidadeJogador;
		}
		if (kb.pressing('shift')){
			y = y*1.5
			x = x*1.5
		}

		
		jogador.velocity.y = y
		jogador.velocity.x = x
	}

</script>
</html>
